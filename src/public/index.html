<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Foros y Comentarios en Tiempo Real</title>
  </head>
  <body>
    <h1>Foros y Comentarios en Tiempo Real</h1>

    <h2>Foros</h2>
    <div id="foros"></div>

    <h2>Comentarios</h2>
    <div id="comentarios"></div>

    <form id="formComentario">
      <input type="text" id="usuario" placeholder="Tu usuario" required />
      <input
        type="text"
        id="contenido"
        placeholder="Escribe un comentario"
        required
      />
      <button type="submit">Enviar</button>
    </form>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const socket = io("http://localhost:3402"); // Ajusta el puerto

      const forosDiv = document.getElementById("foros");
      const comentariosDiv = document.getElementById("comentarios");
      const formComentario = document.getElementById("formComentario");
      const usuarioInput = document.getElementById("usuario");
      const contenidoInput = document.getElementById("contenido");

      // Conexión
      socket.on("connect", () =>
        console.log("Conectado al servidor con ID:", socket.id)
      );

      // Pedir todos los foros al cargar
      socket.emit("get-all-foros");

      // Mostrar foros
      socket.on("all-foros", (foros) => {
        forosDiv.innerHTML = "";
        foros.forEach((foro) => {
          const div = document.createElement("div");
          div.innerHTML = `<strong>${foro.title}</strong>: ${foro.description}`;
          forosDiv.appendChild(div);
        });
      });

      // Mostrar comentarios cuando se crea uno nuevo
      socket.on("coment-created", (comentario) => {
        mostrarComentario(comentario);
      });

      // Mostrar todos los comentarios
      socket.on("coments", (comentarios) => {
        comentariosDiv.innerHTML = "";
        comentarios.forEach(mostrarComentario);
      });

      // Función para mostrar un comentario
      function mostrarComentario(comentario) {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${comentario.idUser}</strong>: ${comentario.content}`;
        comentariosDiv.appendChild(div);
      }

      // Enviar nuevo comentario
      formComentario.addEventListener("submit", (e) => {
        e.preventDefault();
        const comentario = {
          idUser: usuarioInput.value,
          content: contenidoInput.value,
          idComent: null,
        };
        socket.emit("new-public", comentario);
        contenidoInput.value = "";
      });

      // Pedir todos los comentarios al cargar la página
      socket.emit("all-public");
    </script>
  </body>
</html>
